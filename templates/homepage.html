{% extends "site_base.html" %}

{% load i18n %}
{% load ifsetting_tag %}

{% load participation_tags %}

{% block head_title %}{% blocktrans %}Welcome{% endblocktrans %}{% endblock %}

{% block extra_head %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?libraries=geometry&amp;sensor=false&amp;language=en"></script>
<script src="{{ STATIC_URL }}js/infobubble-compiled.js"type="text/javascript"></script>
<script src="{{ STATIC_URL }}js/vote.js"type="text/javascript"></script>
<link rel="stylesheet" href="{{ STATIC_URL }}css/maps.css" type="text/css" media="all" charset="utf-8" />
{% endblock %}

{% block body_class %}{% endblock %}

{% block map %}
    <div id="the_map"class="mapContainer minor">
    <div id="map"></div>
    <div id="map-intro-message">
    <a href="javascript:document.getElementById("the_map").removeChild(document.getElementById("map-intro-message")); center();" class="close">Close</a>
  
      <h3>Get Involved</h3>
      <p class="focus">
        <span>The Green Line is coming to Somerville and we need your thoughts! Share your ideas, questions, photos and videos with the community!</span>
      </p>
      <a href="/about">Learn about this project</a>
      <a href="/help">View help on using this site</a>
    </div>
        <div>
        <map-button type="submit" onclick="togglePhotos();">-/+ Photos</map-button>
        <map-button type="submit" onclick="toggleVideos();">-/+ Videos</map-button>
        <map-button type="submit" onclick="toggleLocations();">-/+ Ideas</map-button>
        <map-button type="submit" onclick="toggleOverlays();">-/+ Overlays</map-button>
        <map-button type="submit" onclick="zoomIn();">+ Zoom</map-button>
        <map-button type="submit" onclick="zoomOut();">- Zoom</map-button>
        <map-button type="submit" onclick="reset();">Reset</map-button>
        </div>
    </div>
{% endblock %}

{% block body %}
<div class="grid_7">
	<h2>From the Community</h2>
	<div class="shared">
		<div class="comments"></div>
	</div>
</div>
	
<div class="grid_5">
	<form action="#" method="post" id="address-search">
		{% csrf_token %}
		<h2>Find Your Station</h2>
		<div class="row">
			<label for="id_address">Enter an address below to see what"s happening.</label>
			<input type="text" name="address" id="id_address">
			<button type="submit">Find my station</button>
			<p class="help-text"><strong>EXAMPLES:</strong> 83 Highland Avenue, 24 Richdale Ave</p>
		</div>
	</form>
	<script src="http://widgets.twimg.com/j/2/widget.js"></script>
	<script type="text/javascript">
		new TWTR.Widget({
			version: 2,
			type: "profile",
			rpp: 4,
			interval: 6000,
			width: "auto",
			height: 300,
			theme: {
				shell: {
					background: "#FAFAFA",
					color: "#777777"
				},
				tweets: {
					background: "#FAFAFA",
					color: "#777777",
					links: "#32a800"
				}
			},
			features: {
				scrollbar: true,
				loop: false,
				live: true,
				hashtags: true,
				timestamp: true,
				avatars: false,
				behavior: "all"
			}
		}).render().setUser("ISomerville").start();
	</script>
</div>
{% endblock %}

{% block body_onload %}initialize(){% endblock %}

{% block extra_body %}
<script src="{{ STATIC_URL }}js/map.js" type="text/javascript"></script>
<script type="text/javascript">
		
	function initialize() {
		
		// basemap
		greenline.createBasemap('map');
		
		// zoom and center
		greenline.map.setOptions({
			zoom: 13,
			center: new google.maps.LatLng(42.397, -71.13)
		});
		
		// station icon
		var s_icon = new google.maps.MarkerImage('{{ STATIC_URL }}img/isicons/train.png',
			new google.maps.Size(32,37),
			new google.maps.Point(0,0),
			new google.maps.Point(16,37)
		);
		var s_shadow = new google.maps.MarkerImage('{{ STATIC_URL }}img/isicons/shadow.png',
			new google.maps.Size(51,37),
			new google.maps.Point(0,0),
			new google.maps.Point(16,37)
		);
		{% for station in stations %}
		var s_{{ station.id }}_ll = new google.maps.LatLng({{ station.geometry.y }},{{ station.geometry.x }});
		var s_{{ station.id }} = new google.maps.Marker({
			position: s_{{ station.id }}_ll, 
			map: greenline.map,
			title:"{{ station.name }}",
			shadow: s_shadow,
			icon: s_icon
		});
		var s_{{ station.id }}_area = new google.maps.Circle({
			map: greenline.map,
			fillColor: '#4F7B41',
			strokeColor: '#FFFFFF',
			fillOpacity: .3,
			strokeWeight: .6,
			radius: 804.67 // 804.67m = 0.5mi
		});
		s_{{ station.id }}_area.bindTo('center', s_{{ station.id }}, 'position');
		greenline.createInfoBubble('station', s_{{ station.id }}, '<div class="infobubble"><span class="title">{{ station.name }}</span><p>{{ station.desc|truncatewords:30 }}<br><a href="{{ station.get_absolute_url }}">Explore the Station Area!</a></p></div>');
		{% endfor %}
		
		{% for line in lines %}		
		var l_{{ line.id }} = new google.maps.Polyline({
			path: google.maps.geometry.encoding.decodePath("{{ line.encoded.points|fixbackslash }}"),
			levels: greenline.decodeLevels("{{ line.encoded.levels }}"),
			strokeColor: '#4F7B41',
			strokeOpacity: 0.9,
			strokeWeight: 6,
			zoomFactor: {{ line.encoded.zoomFactor }}, 
			numLevels: {{ line.encoded.numLevels }},
			map: greenline.map
		});	
		{% endfor %}
		
	}

</script>

{% endblock %}
